<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server Monitor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
        }
        .hidden {
            display: none;
        }
        .error {
            color: red;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="login-screen">
        <h2>Login</h2>
        <input type="text" id="username" placeholder="Enter your username"><br><br>
        <button onclick="login()">Login</button>
        <p id="error-message" class="error"></p>
    </div>

    <!-- Monitor Screen -->
    <div id="monitor-screen" class="hidden">
        <h1>Real-time Server Statistics</h1>
        <div id="stats">Loading...</div>
    </div>

    <script>
        const usernameInput = document.getElementById("username");
        const errorMessage = document.getElementById("error-message");
        const loginScreen = document.getElementById("login-screen");
        const monitorScreen = document.getElementById("monitor-screen");
        const statsDiv = document.getElementById("stats");

        const server_url = 'wss://' + location.host + location.pathname.replace('monitor', 'ws');
        const ws = new WebSocket(server_url);

        ws.onerror = (e) => {
            statsDiv.innerHTML = `<div style="color:red;">WebSocket Error: ${e.message}</div>`;
        };

        ws.onmessage = (event) => {
            const message = JSON.parse(event.data);
            if (message[0] === "stats") {
                updateStats(message[1]);
            }
        };

        function login() {
            const username = usernameInput.value.trim();
            if (username) {
                localStorage.setItem("username", username);
                errorMessage.innerText = "";
                loginScreen.classList.add("hidden");
                monitorScreen.classList.remove("hidden");
                requestStats();
            } else {
                errorMessage.innerText = "Username cannot be empty!";
            }
        }

        function updateStats(stats) {
            statsDiv.innerHTML = `
                <div><strong>CPU Usage:</strong> ${stats.cpu}%</div>
                <div><strong>Memory Usage:</strong>
                    ${((stats.memory.used / stats.memory.total) * 100).toFixed(2)}%
                    (${(stats.memory.used / 1e9).toFixed(2)} GB / ${(stats.memory.total / 1e9).toFixed(2)} GB)
                </div>
                <div><strong>Disk Usage:</strong>
                    ${stats.disk.percent}%
                    (${(stats.disk.used / 1e9).toFixed(2)} GB / ${(stats.disk.total / 1e9).toFixed(2)} GB)
                </div>
                <div><strong>Load Average:</strong>
                    1m: ${stats.load_avg[0].toFixed(1)}, 5m: ${stats.load_avg[1].toFixed(1)}, 15m: ${stats.load_avg[2].toFixed(1)}
                </div>
            `;
        }

        function requestStats() {
            if (ws.readyState === WebSocket.OPEN) {
                ws.send("stats");
            }
        }

        setInterval(requestStats, 3000); // Request stats every 3 seconds
    </script>
</body>
</html>
