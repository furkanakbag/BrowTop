<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server Monitor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .stats, .processes, .logs, .logged-users {
            margin-top: 10px;
        }
        .stat, .process, .log, .user {
            margin: 10px 0;
        }
        .error {
            color: red;
        }
    </style>
</head>
<body>
    <h1>Server Monitoring Dashboard</h1>
    <div class="stats" id="stats"></div>
    <div class="processes" id="processes"></div>
    <div class="logs" id="logs">
        <h3>System Logs</h3>
        <div id="log-list"></div>
    </div>
    <div class="logged-users" id="logged-users">
        <h3>Logged Users</h3>
        <div id="user-list"></div>
    </div>
    <script>
        const server_url = 'wss://' + location.host + location.pathname.replace('monitor', 'ws');
        const statsDiv = document.getElementById('stats');
        const processesDiv = document.getElementById('processes');
        const logListDiv = document.getElementById('log-list');
        const userListDiv = document.getElementById('user-list');
        const ws = new WebSocket(server_url);

        ws.onopen = () => console.log("Connected to server");
        ws.onmessage = (event) => {
            const message = JSON.parse(event.data);
            if (message[0] === 'stats') {
                const data = message[1];
                updateStats(data);
            }
        };

        function updateStats(data) {
            statsDiv.innerHTML = `
                <div class="stat"><strong>CPU Usage:</strong> ${data.cpu}%</div>
                <div class="stat"><strong>Memory Usage:</strong> ${((data.memory.used / data.memory.total) * 100).toFixed(2)}%</div>
                <div class="stat"><strong>Disk Usage:</strong> ${data.disk.percent}%</div>
                <div class="stat"><strong>Load Average:</strong> ${data.load_avg.join(', ')}</div>
                <div class="stat"><strong>System Uptime:</strong> ${new Date(data.uptime * 1000).toISOString().substr(11, 8)}</div>
            `;

            processesDiv.innerHTML = `
                <h3>Processes</h3>
                <div>Total: ${data.process_summary.total}</div>
                <div>Running: ${data.process_summary.running}</div>
                <div>Sleeping: ${data.process_summary.sleeping}</div>
                <div>Stopped: ${data.process_summary.stopped}</div>
                <div>Zombie: ${data.process_summary.zombie}</div>
            `;

            logListDiv.innerHTML = data.system_logs.map(log => `<div class="log">${log}</div>`).join('');
            userListDiv.innerHTML = data.logged_users.map(user => `<div class="user">${user}</div>`).join('');
        }

        setInterval(() => ws.send('stats'), 1000);
    </script>
</body>
</html>
