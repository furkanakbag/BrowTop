<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Monitor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .stats, .logs, .processes {
            margin-top: 10px;
        }
        .stat, .log, .process {
            margin: 10px 0;
        }
        .error {
            margin: 10px 0;
            color: red;
        }
    </style>
</head>
<body>
    <h1>System Monitoring Dashboard</h1>
    <div class="error" id="error"></div>
    <div class="stats" id="stats"></div>
    <div class="processes" id="processes"></div>
    <div class="logs" id="logs"></div>
    <script>
        const server_url = 'wss://' + location.host + location.pathname.replace('monitor', 'ws');
        const statsDiv = document.getElementById('stats');
        const processesDiv = document.getElementById('processes');
        const logsDiv = document.getElementById('logs');
        const errorDiv = document.getElementById('error');
        const ws = new WebSocket(server_url);

        ws.onopen = () => {
            statsDiv.innerHTML = `<div class="stat">Connected</div>`;
        };

        ws.onerror = (e) => {
            errorDiv.innerHTML = `<div class="error">Error: ${e.message}</div>`;
        };

        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            if (data.stats) {
                statsDiv.innerHTML = `
                    <div class="stat"><strong>CPU Usage:</strong> ${data.stats.cpu}%</div>
                    <div class="stat"><strong>Memory Usage:</strong> ${(data.stats.memory.used / data.stats.memory.total * 100).toFixed(2)}%</div>
                    <div class="stat"><strong>Disk Usage:</strong> ${data.stats.disk.percent}%</div>
                `;
                processesDiv.innerHTML = `
                    <h2>Processes</h2>
                    ${data.stats.processes.map(proc => `<div>${proc.pid}: ${proc.name} (${proc.cpu_percent}%)</div>`).join('')}
                `;
                logsDiv.innerHTML = `
                    <h2>Logs</h2>
                    <ul>${data.logs.map(log => `<li>${log}</li>`).join('')}</ul>
                `;
            }
        };

        ws.onclose = () => {
            statsDiv.innerHTML = `<div class="stat" style="color:red;">Connection closed</div>`;
        };
    </script>
</body>
</html>
